<!DOCTYPE html>
<html>
<body>

<center><h1>My First JSON-to-table-and-back</h1></center>
<p>Select JSON file to parse</p>
<input type = "file" id = "fileJSON" onchange="loadJSON(event)"/>
<p> or </p>
<button id = "createFile" onclick="createNewJSON()">Create new file</button>
<div id = "space"></div>
<p id = "debugP"></p>
<p id = "debugP2"></p>
<output id = "outP"></output>
<script>
function loadJSON(event){
    var files = event.target.files;
    var reader = new FileReader();
    var tabTitle = [];
    var tabContent = [];
    var newJSON = {};
    reader.onload = (function (f) {
        return function (e) {
            newJSON = JSON.parse(e.target.result);
            for (var i of Object.keys(newJSON)) {
                var arr = newJSON[i]; 
                for (var j = 0; j < arr.length ; j++) {
                    var tempArr = [Object.keys(arr[j]).length];
                    for (var k of Object.keys(arr[j])) {
                        
                       if (getHeadId(tabTitle, k) === false) {
                            tabTitle.push(k);
                        }
                        tempArr[getHeadId(tabTitle, k)] = arr[j][k];
                        //tabContent[Number(j)][getHeadId(tabTitle, k)] = arr[j][k];
                       // document.getElementById("debugP").innerHTML += i + Object.keys(arr[j])+ " " + k + " " +arr[j][k];
                        document.getElementById("debugP").innerHTML += arr[j][k] + " " + j + " " + k;
                        
                    }
                    tabContent[j] = tempArr;
                    document.getElementById("debugP2").innerHTML = tabTitle + "======" + tabContent.length;
                }
                createTable(i, tabTitle, tabContent);
            }
        }
    })(files[0]);
    reader.readAsText(files[0]);
    createTable(newJSON);

}
function getHeadId(inpArr,val) {
    for (var z = 0; z < inpArr.length; z++) {
        if (inpArr[z] == val) {
            return z;
        }
    }
    return false
}
function createNewJSON() {
    
} 
function createTable(title, head, data) {
    var table = document.createElement('table');
    var tit = document.createElement('h2');
    tit.innerHTML = title;
    if (arguments.length === 0){
        
    }
    else {
        document.getElementById('outP').insertBefore(tit,null);
        
    }
    
}
</script>
</body>
</html> 